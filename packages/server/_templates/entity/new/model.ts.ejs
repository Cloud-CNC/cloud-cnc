---
to: src/models/<%- h.changeCase.param(h.inflection.singularize(name)) %>.ts
---
/**
 * @fileoverview Unified <%- h.changeCase.no(h.inflection.singularize(name)) %> model
 */

//Imports
import Joi from 'joi';
import {Document, model as createModel} from 'mongoose';
import joigoose from '@/lib/joigoose';

//<%- h.changeCase.sentence(h.inflection.singularize(name)) %> interface
interface I<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>
{<% for (const field of uniqueFields) { %>
  /**
<%- h.multiline(field.description, 3) %>
   */
  <%- field.name %><%- !field.required ? '?' : '' %>: <%- field.typescriptType %>;
<% } -%>
}

//<%- h.changeCase.sentence(h.inflection.singularize(name)) %> document
type I<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>Document = Document<unknown, any, I<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>>;

//<%- h.changeCase.sentence(h.inflection.singularize(name)) %> schema
const <%- h.changeCase.pascal(h.inflection.singularize(name), false) %>Schema = Joi.object({
<% for (const [field, separator] of h.list(uniqueFields, ',')) { -%>
  <%- field.name %>: <%- field.joiType %><%- field.required ? '.required()' : '.optional()' %><%- separator %>
<% } -%>
});

//<%- h.changeCase.sentence(h.inflection.singularize(name)) %> model
const <%- h.changeCase.pascal(h.inflection.singularize(name), false) %> = createModel<I<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>>('<%- h.changeCase.camel(h.inflection.pluralize(name), false) %>', joigoose.convert(<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>Schema));
<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>.schema.set('toObject', {
  virtuals: true,
  versionKey: false,
  transform: (document: I<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>Document, value: any) =>
  {
    //Delete the Object ID
    delete value._id;

    //Delete the stringified ID if not specifically selected for
    if (!document.isSelected('id'))
    {
      delete value.id;
    }
  }
});

//Export
export {
  I<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>,
  I<%- h.changeCase.pascal(h.inflection.singularize(name), false) %>Document,
  <%- h.changeCase.pascal(h.inflection.singularize(name), false) %>Schema,
  <%- h.changeCase.pascal(h.inflection.singularize(name), false) %>
};